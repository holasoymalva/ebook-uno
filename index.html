<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="src/styles/styles.css">
</head>

<body>
     <!-- Add audio element -->
     <audio id="bgMusic" loop>
        <source src="src/songs/childhood.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <div class="section" id="title-section">
        <div class="content">
            <h1 class="title">Cuando las flores cantan</h1>
            <h2 class="author">By Leon Martin</h2>
        </div>
    </div>

    <div class="story-section" id="story-section">
        <div class="story-content">
            <div class="story-text">
                <h3 class="story-title">Olvidé los audífonos...</h3>
                <p class="story-paragraph">En algún lugar de mi casa, olvidé mis audífonos, ¿De qué sirve tener música si no puedes disfrutarla?, estuve vulnerable a las conversaciones de la gente del metro.</p>
                <p class="story-paragraph">Hubo una que me llamó la atención. Una chica repitiéndole a un tipo que lo amaba. Ella lo miraba, él la miraba, ambos se miraban, se besaban y suspiraban.</p>
                <p class="story-paragraph">Cuando llegamos a la estación Pantitlán, ella con mucha ternura se despidió de él. Lo llenó de besos, mientras repetía que lo adoraba con un tono infantil. Me conmoví, y no lo niego, por un instante quería estar en su lugar.</p>
                <p class="story-paragraph">Al salir del vagón quede detrás de ella, bajamos las escaleras, ella llevaba una lapicera de Hello Kitty y una pequeña mochila en la que difícilmente entraba un estuche de maquillaje de color verde, aún lo recuerdo y yo, la miraba con atención, tenía unos bonitos tatuajes en sus brazos, flores y tallos que bailaban al ritmo de sus movimientos, no lo niego me hubiera gustado ser aquel chico al que tanto quería.</p>
                <p class="story-paragraph">Continuamos caminando hasta llegar al trasbordo, ella aceleró el paso, abrazo a otro chico que la esperaba en los torniquetes, se miraron tiernamente, se besaron y suspiraron, seguí caminando y me lamente por aquellos batos.</p>
                <p class="story-paragraph">Extrañaba mis audífonos, extrañaba no entrometerme en otras vidas.</p>

                <h3 class="story-title">Donde los Gatos Bailan</h3>
                <p class="story-paragraph">Había una vez un gato que no quería ser gato, de sus siete vidas solo le quedaba una, dormir y dormir, cada noche con menos ilusiones ¿Cazar? ¿Para qué cazar? ¿Maullar? ¿Para qué Maullar? ¿Qué lo hará diferente esta vez?</p>
                <p class="story-paragraph">Desilusionado, un día callo un libro del ropero, libro rojo que jamás había visto en sus vidas y que al llegar a verlo, se vio a sí mismo, gato pardo de ojos amarillos, ojos estrella y piel de mariposa, patitas de seda y cabello de membrillo. Y de entre las letras se vio a él vuelto humana, bailando ballet, donde los gatos bailan.</p>
            </div>
        </div>
    </div>

    <script>
        const leafCount = 30;
            const leaves = [];

            function createLeaves() {
                const body = document.body;
                for (let i = 0; i < leafCount; i++) {
                    const leaf = document.createElement('div');
                    leaf.className = 'leaf';
                    leaf.style.left = `${Math.random() * 100}vw`;
                    leaf.style.top = `${Math.random() * 100}vh`;
                    leaf.style.transform = `rotate(${Math.random() * 360}deg)`;
                    body.appendChild(leaf);
                    leaves.push({
                        element: leaf,
                        x: Math.random() * window.innerWidth,
                        y: Math.random() * window.innerHeight,
                        speedX: Math.random() * 2 - 1,
                        speedY: Math.random() * 2 + 1,
                        rotation: Math.random() * 360,
                        rotationSpeed: (Math.random() - 0.5) * 2
                    });
                }
            }

            function animateLeaves() {
                const documentHeight = Math.max(
                    document.body.scrollHeight,
                    document.documentElement.scrollHeight
                );
                leaves.forEach(leaf => {
                    leaf.x += leaf.speedX;
                    leaf.y += leaf.speedY;
                    leaf.rotation += leaf.rotationSpeed;
                    // Reiniciar la posición cuando la hoja sale de la vista
                    if (leaf.y > window.innerHeight + window.scrollY) {
                        leaf.y = window.scrollY - 50;
                        leaf.x = Math.random() * window.innerWidth;
                    }
                    // Si la hoja sale por los lados, reubicarla
                    if (leaf.x < -50) leaf.x = window.innerWidth;
                    if (leaf.x > window.innerWidth + 50) leaf.x = -50;
                    leaf.element.style.transform = `translate(${leaf.x}px, ${leaf.y}px) rotate(${leaf.rotation}deg)`;
                    // Ajustar la opacidad basada en la posición en la página
                    const scrollProgress = window.scrollY / (documentHeight - window.innerHeight);
                    const fadeStart = 0.8; // Punto donde comienza el fade out
                    if (scrollProgress > fadeStart) {
                        const fadeOutProgress = (scrollProgress - fadeStart) / (1 - fadeStart);
                        leaf.element.style.opacity = Math.max(0, 1 - fadeOutProgress);
                    } else {
                        leaf.element.style.opacity = 1;
                    }
                });
                requestAnimationFrame(animateLeaves);
            }

            function handleScroll() {
                const scrolled = window.scrollY;
                const windowHeight = window.innerHeight;

                // Título y autor
                const title = document.querySelector('.title');
                const author = document.querySelector('.author');
                if (scrolled < windowHeight) {
                    title.classList.add('visible');
                    author.classList.add('visible');
                    const scale = 1 + (scrolled / windowHeight) * 0.5;
                    const opacity = 1 - (scrolled / windowHeight);
                    document.querySelector('.content').style.transform = `scale(${scale}) translateZ(${scrolled}px)`;
                    title.style.opacity = opacity;
                    author.style.opacity = opacity;
                }

                // Historia y títulos de cada cuento
                const storyContent = document.querySelector('.story-content');
                const storyTitles = document.querySelectorAll('.story-title');
                const storyRect = document.querySelector('.story-section').getBoundingClientRect();

                if (storyRect.top < windowHeight * 0.8) {
                    storyContent.classList.add('visible');

                    // Iterar sobre cada título y hacerlos visibles uno por uno
                    storyTitles.forEach((storyTitle) => {
                        const rect = storyTitle.getBoundingClientRect();
                        if (rect.top < windowHeight * 0.8) {
                            storyTitle.classList.add('visible');
                        }
                    });

                    // Revelar párrafos gradualmente
                    const paragraphs = document.querySelectorAll('.story-paragraph');
                    paragraphs.forEach((paragraph, index) => {
                        const rect = paragraph.getBoundingClientRect();
                        if (rect.top < windowHeight * 0.9) {
                            setTimeout(() => {
                                paragraph.classList.add('visible');
                            }, index * 200);
                        }
                    });
                }
            }

            window.addEventListener('load', () => {
                createLeaves();
                animateLeaves();
                handleScroll();
            });
            window.addEventListener('scroll', () => {
                requestAnimationFrame(handleScroll);
            });
            window.addEventListener('resize', () => {
                leaves.forEach(leaf => {
                    leaf.x = Math.random() * window.innerWidth;
                    leaf.y = Math.random() * window.innerHeight;
                });
            });
            // Función para crear el efecto de rastro del cursor
            function createTrailEffect(e) {
                const trail = document.createElement('div');
                trail.className = 'cursor-trail';
                trail.style.left = e.clientX + 'px';
                trail.style.top = e.clientY + window.scrollY + 'px';
                document.body.appendChild(trail);
                // Eliminar el elemento después de la animación
                setTimeout(() => {
                    trail.remove();
                }, 1000);
            }
            // Función para limitar la frecuencia de creación de efectos
            function throttle(func, limit) {
                let inThrottle;
                return function (e) {
                    if (!inThrottle) {
                        func(e);
                        inThrottle = true;
                        setTimeout(() => inThrottle = false, limit);
                    }
                }
            }
            // Agregar el evento del mouse con throttle
            document.addEventListener('mousemove', throttle(createTrailEffect, 50));



            // Configuración de las flores
            const FLOWER_CONFIG = {
                count: 12, // Número total de flores a mostrar
                sizes: ['small', 'normal', 'large'], // Clases de tamaños
                baseDepth: 0.05, // Profundidad base para el efecto parallax
            };

            // Función para crear flores con parallax
            function createParallaxFlowers() {
                const flowers = [];

                for (let i = 1; i <= FLOWER_CONFIG.count; i++) {
                    const flower = document.createElement('div');
                    flower.className = 'parallax-flower';

                    // Añadir clase de tamaño aleatoria
                    const sizeClass = FLOWER_CONFIG.sizes[Math.floor(Math.random() * FLOWER_CONFIG.sizes.length)];
                    flower.classList.add(sizeClass);

                    const img = document.createElement('img');
                    // Usar la ruta correcta a las imágenes
                    const imageNumber = Math.floor(Math.random() * 4) + 1; // Asumiendo que tienes 4 imágenes
                    img.src = `src/pictures/flowers/${imageNumber}.png`;
                    img.alt = `Flower ${imageNumber}`;

                    // Configurar la posición y rotación inicial
                    flower.appendChild(img);
                    flower.style.left = `${Math.random() * 100}vw`;
                    flower.style.top = `${Math.random() * 100}vh`;

                    // Añadir una rotación inicial aleatoria
                    const initialRotation = Math.random() * 360;
                    flower.style.transform = `rotate(${initialRotation}deg) scale(${0.8 + Math.random() * 0.4})`;

                    document.body.appendChild(flower);

                    // Almacenar propiedades de movimiento
                    flowers.push({
                        element: flower,
                        depth: FLOWER_CONFIG.baseDepth * (1 + Math.random()),
                        rotationSpeed: (Math.random() - 0.5) * 0.1,
                        initialX: parseFloat(flower.style.left),
                        initialY: parseFloat(flower.style.top),
                        amplitude: {
                            x: Math.random() * 30 + 20,
                            y: Math.random() * 30 + 20
                        }
                    });
                }

                return flowers;
            }

            // Función para actualizar la posición de las flores con parallax
            function updateParallaxFlowers(flowers, mouseX, mouseY) {
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;

                flowers.forEach(flower => {
                    const rect = flower.element.getBoundingClientRect();
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;

                    // Calcular el movimiento basado en la posición del mouse
                    const deltaX = (mouseX - windowWidth / 2) * flower.depth;
                    const deltaY = (mouseY - windowHeight / 2) * flower.depth;

                    // Aplicar transformación con parallax y rotación suave
                    flower.element.style.transform = `
                    translate(
                        ${deltaX}px,
                        ${deltaY}px
                    )
                    rotate(${deltaY * flower.rotationSpeed}deg)
                `;
                });
            }

            // Función para manejar el scroll y actualizar la opacidad
            function handleFlowerScroll(flowers) {
                const scrollProgress = window.scrollY / (document.documentElement.scrollHeight - window.innerHeight);
                const fadeStart = 0.8;

                flowers.forEach(flower => {
                    if (scrollProgress > fadeStart) {
                        const fadeOutProgress = (scrollProgress - fadeStart) / (1 - fadeStart);
                        flower.element.style.opacity = Math.max(0, 0.7 - fadeOutProgress);
                    } else {
                        flower.element.style.opacity = 0.7;
                    }
                });
            }

            // Inicialización
            document.addEventListener('DOMContentLoaded', () => {
                const flowers = createParallaxFlowers();
                let rafId = null;

                // Evento de movimiento del mouse para parallax
                document.addEventListener('mousemove', (e) => {
                    if (rafId) {
                        cancelAnimationFrame(rafId);
                    }

                    rafId = requestAnimationFrame(() => {
                        updateParallaxFlowers(flowers, e.clientX, e.clientY);
                    });
                });

                // Manejar scroll
                window.addEventListener('scroll', () => {
                    requestAnimationFrame(() => {
                        handleFlowerScroll(flowers);
                    });
                });

                // Manejar redimensionamiento de ventana
                window.addEventListener('resize', () => {
                    flowers.forEach(flower => {
                        flower.element.style.left = `${Math.random() * 100}vw`;
                        flower.element.style.top = `${Math.random() * 100}vh`;
                    });
                });

                // Resto del código existente...
                createLeaves();
                animateLeaves();
                handleScroll();
            });



            // Add minimal audio functionality
            document.addEventListener('DOMContentLoaded', () => {
                const audio = document.getElementById('bgMusic');

                // Set initial volume
                audio.volume = 0.5;

                // Handle autoplay with user interaction requirement
                const startAudio = () => {
                    audio.play().catch(() => {
                        // If autoplay was prevented, wait for user interaction
                        document.addEventListener('click', () => {
                            audio.play();
                        }, { once: true });
                    });
                };

                // Start audio when document is ready
                startAudio();
            });
    </script>
</body>

</html>
